
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Cisco SD-WAN Lab">
      
      
        <meta name="author" content="CX Team">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.7">
    
    
      
        <title>Task 5 Establish VPN connectivity on Fabric - LEAP 2022 - Cisco SD-WAN Lab</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#task-5-vpn-on-the-fabric" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="LEAP 2022 - Cisco SD-WAN Lab" class="md-header__button md-logo" aria-label="LEAP 2022 - Cisco SD-WAN Lab" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LEAP 2022 - Cisco SD-WAN Lab
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Task 5 Establish VPN connectivity on Fabric
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="LEAP 2022 - Cisco SD-WAN Lab" class="md-nav__button md-logo" aria-label="LEAP 2022 - Cisco SD-WAN Lab" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LEAP 2022 - Cisco SD-WAN Lab
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Topology/" class="md-nav__link">
        Topology
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task1-Connect/" class="md-nav__link">
        Task 1 Remote Connection
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task2-Exploring%20Control%20Plane/" class="md-nav__link">
        Task 2 Control Plane
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task3-vEdge/" class="md-nav__link">
        Task 3 vEdge on internal networks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task4-Full-Mesh/" class="md-nav__link">
        Task 4 Full-Mesh Data Plane on internal networks
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Task 5 Establish VPN connectivity on Fabric
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Task 5 Establish VPN connectivity on Fabric
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sdwan-lab-topology" class="md-nav__link">
    SDWAN Lab Topology
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-create-vpns-on-branch-1" class="md-nav__link">
    Step 1: Create VPNs on Branch 1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-create-vpns-on-data-center-and-branch-2" class="md-nav__link">
    Step 3: Create VPNs on Data Center and Branch 2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-verify-vpns-routing-on-all-vedges" class="md-nav__link">
    Step 4: Verify VPNs routing on all vEdges
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task6-HubnSpoke_VPN20/" class="md-nav__link">
        Task 6 Hub & Spoke Topology
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sdwan-lab-topology" class="md-nav__link">
    SDWAN Lab Topology
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-create-vpns-on-branch-1" class="md-nav__link">
    Step 1: Create VPNs on Branch 1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-create-vpns-on-data-center-and-branch-2" class="md-nav__link">
    Step 3: Create VPNs on Data Center and Branch 2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-verify-vpns-routing-on-all-vedges" class="md-nav__link">
    Step 4: Verify VPNs routing on all vEdges
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="task-5-vpn-on-the-fabric">Task 5 - VPN on the Fabric</h1>
<p>This task will walk through the steps to create full mesh VPN on the SD-WAN Fabric.  Hence the traffic on these VPNs can be passed on the SDWAN Fabric keeping the end-to-end segmentation.  We will create VPN number 10, 20, 30 in this exercise.  .</p>
<p>This configuration of vEdge can be done via Feature Templates or by using CLI Template on the vManage.  We will use CLI Template of the vEdge for this lab.  To provide differentiation, two separate CLI Templates will be created for vEdges in DC and Branches.</p>
<h4 id="sdwan-lab-topology">SDWAN Lab Topology</h4>
<p>The logical topology of VPN number 10 is shown in below figure:</p>
<p><img alt="VPN traffic" src="../pics/t5-vpn10_topology.png" /></p>
<p><strong>Pre-requisite:</strong>  SDWAN controllers and 3 vEdges (in Branches &amp; DC) must be fully operational.  If those are not installed (or not operational) then please complete the previous Tasks first.</p>
<h2 id="step-1-create-vpns-on-branch-1">Step 1: Create VPNs on Branch 1</h2>
<ul>
<li>
<p>Log on to the vManage from a web browser (if not already open) and use credentials of <code>admin</code> and <code>admin</code>:</p>
</li>
<li>
<p>On the vManage GUI, navigate to <strong>Configuration &gt; Templates &gt; Device</strong>.  </p>
</li>
<li>
<p>Then <strong>Select</strong> the CLI template named <strong>"BR1-vEdge01"</strong>.  Next, Click on the three dots on right-side as shown in below screenshot. </p>
<p><img alt="CLI Template" src="../pics/t5-br1-clitemplate-edit2.png" /></p>
</li>
<li>
<p>Edit option will allow you to add additional configurations in this template.  </p>
<ul>
<li><strong>Scroll</strong> all the way to the end of existing template, </li>
<li>Then you can <strong>add</strong>  (copy &amp; paste will work) the below configuration at the end of the exiting template,</li>
<li>Do not make any other changes to existing configurations in this template<pre><code>vpn 10
 name AppVPN
 interface loopback10
  ip address 10.102.10.10/32
  no shutdown
!
vpn 20
 name BusinessVPN
 interface loopback20
  ip address 10.102.20.10/32
  no shutdown
!
vpn 30
 name MarketingVPN
 interface loopback30
  ip address 10.102.30.10/32
  no shutdown
</code></pre>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Important Note:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Be very careful in making configuration changes on vEdge.  <strong>Do NOT change</strong> any <strong>configuration</strong> of VPN 512 as it can result in loss of connectivity to the vEdge - which can not be restored.   You will have to start the lab again from Task #1 if you loose network connectivity to a vEdge.</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>After adding above configuration to this Template, <strong>Click</strong> on <code>Update</code> button.  </p>
</li>
<li>
<p>On the next screen,</p>
<ul>
<li><strong>Select</strong> the <code>BR1-vEdge</code> under the <strong>Device list</strong> section (left part of screen).  </li>
<li>
<p>Then <strong>Select</strong> both <code>"Config Preview"</code> and <code>"Config Diff"</code> options to verify that VPN 10 related configurations are added to this vEdge, and no changes to VPN 512 (or other interfaces) are done.</p>
<table>
<thead>
<tr>
<th align="left">Important Note:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Be very careful in making configuration changes on vEdge.  <strong>Do NOT change</strong> any <strong>configuration</strong> of VPN 512 as it can result in loss of connectivity to the vEdge - which can not be restored.   You will have to start the lab again from Task #1 if you loose network connectivity to a vEdge.</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Once you have verifed the config changes <strong>Click</strong> on <code>Configure Devices</code> button on the lower section of screen, as shown in below screenshot:</p>
</li>
</ul>
<p><img alt="CLI Template" src="../pics/t5-br1-clitemplate-loopback-configdev.png" /></p>
</li>
</ul>
<p>This completes the configuration of VPN 10, 20 &amp; 30 on BR1-vEdge</p>
<h2 id="step-3-create-vpns-on-data-center-and-branch-2">Step 3: Create VPNs on Data Center and Branch 2</h2>
<p>Now lets create VPNs on remaining vEdge. Follow the same steps of modifying the template and add the following configs for DC and BR2</p>
<table>
<thead>
<tr>
<th><strong>vEdge</strong></th>
<th><strong>Configs</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DC1-vEdge01</strong></td>
<td><strong>vpn 10</strong><br/> interface loopback10<br/> ip address 10.101.10.10/32 <br/> no shutdown<br/>!<br/><strong>vpn 20</strong><br/> interface loopback20<br/> ip address 10.101.20.10/32 <br/> no shutdown<br/>!<br/><strong>vpn 30</strong><br/> interface loopback30<br/> ip address 10.101.30.10/32 <br/> no shutdown</td>
</tr>
<tr>
<td><strong>BR2-vEdge01</strong></td>
<td><strong>vpn 10</strong><br/> interface loopback10<br/> ip address 10.103.10.10/32 <br/> no shutdown<br/>!<br/><strong>vpn 20</strong><br/> interface loopback20<br/> ip address 10.103.20.10/32 <br/> no shutdown<br/>!<br/><strong>vpn 30</strong><br/> interface loopback30<br/> ip address 10.103.30.10/32 <br/> no shutdown</td>
</tr>
</tbody>
</table>
<h2 id="step-4-verify-vpns-routing-on-all-vedges">Step 4: Verify VPNs routing on all vEdges</h2>
<p>Now we can verify the IP connectivity between vEdge in Branch-1 and Branch-2 on the VPN 10.</p>
<ul>
<li>
<p>Execute below commands on </p>
<pre><code>show ip route 
show ip route vpn 10
show omp routes
show omp routes vpn 10
</code></pre>
<p>You should verify that each vEdge has learned the LAN segment IP address of remote vEdge (within VPN 10, 20 and 30) </p>
</li>
<li>
<p>ping remomte IPs to verify connectivity</p>
<pre><code>ping 10.101.10.10 vpn 10
</code></pre>
</li>
</ul>
<hr />
<p>You have now completed this task of adding VPNs on the SD-WAN Fabric</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../Task4-Full-Mesh/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Task 4 Full-Mesh Data Plane on internal networks" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Task 4 Full-Mesh Data Plane on internal networks
            </div>
          </div>
        </a>
      
      
        
        <a href="../Task6-HubnSpoke_VPN20/" class="md-footer__link md-footer__link--next" aria-label="Next: Task 6 Hub &amp; Spoke Topology" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Task 6 Hub & Spoke Topology
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.01de222e.min.js"></script>
      
    
  </body>
</html>