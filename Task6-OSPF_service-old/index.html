
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for Cisco SD-WAN Lab">
      
      
        <meta name="author" content="CX Team">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.7">
    
    
      
        <title>Task6 OSPF service old - LEAP 2022 - Cisco SD-WAN Lab</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sdwan-lab-topology" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="LEAP 2022 - Cisco SD-WAN Lab" class="md-header__button md-logo" aria-label="LEAP 2022 - Cisco SD-WAN Lab" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LEAP 2022 - Cisco SD-WAN Lab
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Task6 OSPF service old
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="LEAP 2022 - Cisco SD-WAN Lab" class="md-nav__button md-logo" aria-label="LEAP 2022 - Cisco SD-WAN Lab" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    LEAP 2022 - Cisco SD-WAN Lab
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Topology/" class="md-nav__link">
        Topology
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task1-Connect/" class="md-nav__link">
        Task 1 Remote Connection
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task2-Exploring%20Control%20Plane/" class="md-nav__link">
        Task 2 Control Plane
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task3-vEdge/" class="md-nav__link">
        Task 3 vEdge on internal networks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task4-Full-Mesh/" class="md-nav__link">
        Task 4 Full-Mesh Data Plane on internal networks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task5-VPN%20creations/" class="md-nav__link">
        Task 5 Establish VPN connectivity on Fabric
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task8-HubnSpoke_VPN20.md" class="md-nav__link">
        Task 6 Task 8 Hub & Spoke Topology
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sdwan-lab-topology" class="md-nav__link">
    SDWAN Lab Topology
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-adding-ospf-config-in-br2" class="md-nav__link">
    Step 1: Adding OSPF config in BR2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-validate-ospf-in-br2" class="md-nav__link">
    Step 2: Validate OSPF in BR2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-verify-ospf-routes-redistribution" class="md-nav__link">
    Step 3: Verify OSPF routes redistribution
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  <h1>Task6 OSPF service old</h1>

<p>This Task will walk through the steps to perform OSPF peering of the vEdge in Branch 2 on the LAN.  The traffic on the LAN is referred to as Service Side on vEdge.  The OSPF peering will be done for VPN 10 in this exercise.  VPN 10 already exists in BR1 and BR2.</p>
<p>Cisco CSRv exists on the LAN side of BR2 and this CSRv has already been configured with appropriate configurations for OSPF peering.</p>
<h4 id="sdwan-lab-topology">SDWAN Lab Topology</h4>
<p>The logical topology of this branch is shown in below figure:</p>
<p><img alt="OSPF Peering" src="../pics/t6-ospf-topology.png" /></p>
<p><strong>Pre-requisite:</strong></p>
<p>SDWAN controllers and vEdges (in Branches &amp; DC) must be fully operational.  If those are not installed (or not operational) then please complete the previous Tasks first.</p>
<h2 id="step-1-adding-ospf-config-in-br2">Step 1: Adding OSPF config in BR2</h2>
<p>In this step we will configure OSPF area 0 configurations on the vEdge and also validate that the configurations are applied properly.</p>
<ul>
<li>Log on to the vManage from a web browser (if not already open) and use credentials of <code>admin</code> and <code>admin</code>:</li>
</ul>
<pre><code>https://198.18.1.10
</code></pre>
<table>
<thead>
<tr>
<th align="left">Note:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">If <code>admin/admin</code> credentials do not work then you may try using <code>cisco/cisco</code> or <code>cisco1/cisco1</code></td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>On the vManage GUI, navigate to <strong>Configuration &gt; Templates &gt; Device</strong>.  </p>
</li>
<li>
<p>We will make a copy of the existing CLI Template and edit the new Template to add OSPF configurations.  <strong>Click</strong> on the three dots  <code>...</code> on right-side of <strong>"CL-BR2-vEdge1" &gt; Copy</strong>.  Next:</p>
<ul>
<li><strong>Name</strong> the new template as <code>CL-BR2-vEdge1-ospf</code></li>
<li>You may modify <strong>description</strong> to state: <code>Branch2 vEdge1 configs with ospf</code></li>
</ul>
</li>
<li>
<p>Then <strong>Select</strong> the newly CLI template named <strong>"CL-BR2-vedge-ospf"</strong>.  And, <strong>Click</strong> on the three dots <code>...</code> on right-side of <strong>"CL-BR2-vedge-ospf"</strong> and <strong>Select</strong> <code>Edit</code> from the drop-down menu.</p>
</li>
<li>
<p>Edit option will allow you to add <strong>additional configurations</strong> in this template as per below:  </p>
<ul>
<li><strong>Scroll</strong> all the way to the end of existing template, </li>
<li>Then you can <strong>add</strong>  (copy &amp; paste) the below configuration at the end of the exiting template,</li>
<li><strong>Note:</strong> Do not make any other changes to existing configurations in this template</li>
</ul>
</li>
</ul>
<pre><code>vpn 10
 router
  ospf
   default-information originate
   redistribute omp
   area 0
    interface ge0/2
    exit
   exit
</code></pre>
<table>
<thead>
<tr>
<th align="left">Note:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Above configs perform OSPF configuration as well as redistribution of OMP routes into OSPF with "redistribute omp" command</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>Click <strong>Update</strong> to save the new configurations in the template.</p>
</li>
<li>
<p>Now <strong>Attach</strong> this new template (named: "CL-BR2-vEdge1-ospf") to <code>BR2-vEdge</code> by:</p>
<ul>
<li><strong>Click</strong> on the three dots <code>...</code> on right-side of <strong>"CL-BR2-vEdge1"</strong></li>
<li>Select <strong>Attach Devices</strong> from dropdown menu</li>
</ul>
</li>
<li>
<p>Then on next screen, </p>
<ul>
<li><strong>Select</strong> <code>BR2-vEdge</code> with System IP of <code>10.4.0.1</code> in the Available devices</li>
<li><strong>Click</strong> the <code>Right Arrow</code>.  At this point BR2-vEdge will move to the Selected Devices</li>
<li>then <strong>Click</strong> on Attach</li>
</ul>
</li>
<li>
<p>On the subsequent screen, <strong>Click</strong> the <code>Next</code> button</p>
</li>
<li>
<p>On the next screen, <strong>Click</strong> on <code>BR2-vEdge</code> on left section and <strong>Click</strong> on <code>Config Preview</code> and <code>Config Diff</code> options on the right side of window to confirm correct configurations are pushed to this BR2-vEdge.  </p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Important Note:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Be very careful in making configuration changes on vEdge.  <strong>Do NOT change</strong> any <strong>configuration</strong> of VPN 512 as it can result in loss of connectivity to the vEdge - which can not be restored.   You will have to start the lab again from Task #1 if you loose network connectivity to a vEdge.</td>
</tr>
</tbody>
</table>
<ul>
<li>Next <strong>Click</strong> on the <code>Configure Devices</code> button on bottom of the screen.  On the subsequent screen verify that the template is attached successfully to BR2-vEdge</li>
</ul>
<h2 id="step-2-validate-ospf-in-br2">Step 2: Validate OSPF in BR2</h2>
<p>Now lets confirm the OSPF configurations are pushed to vEdge and routes are learned from the OSPF neighbor.</p>
<ul>
<li>
<p>You may access BR2-vEdge by direct <strong>SSH</strong> using the <strong>Mputty client</strong> and initiate SSH to BR2-vEdge with <strong>IP address</strong> of <strong>198.18.134.106</strong> .  Or you may access it the main menu of vManage GUI by navigating to <strong>Tools &gt; SSH Terminal</strong>.  Make sure Device Group states All and  </p>
<ul>
<li><strong>Click</strong> on the <strong>BR2-vEdge</strong>.  </li>
<li>Log into vEdge by using credentials:<ul>
<li>Login name: <code>admin</code> </li>
<li>Password: <code>admin</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Note:</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">If <code>admin/admin</code> credentials do not work then you may try using <code>cisco/cisco</code> or <code>cisco1/cisco1</code></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Next, <strong>execute</strong> the below commands to verify that OSPF configuration on the vEdge-1 in Branch-1:</p>
</li>
</ul>
<pre><code>show run vpn 10
show ospf neighbor
show ospf routes
show ip routes vpn 10
</code></pre>
<p>Below screenshot shows the output of of above commands on BR2-vEdge:</p>
<p><img alt="OSPF on BR2" src="../pics/t6-br2-showrunvpn10-ospf-routes.png" /></p>
<p>From the output of above commands, <strong>confirm</strong> that vEdge-1 in Branch #1 shows that:</p>
<ul>
<li><strong>OSPF</strong> configurations <strong>under VPN 10</strong> exist on the vEdge,</li>
<li><strong>OSPF neighbor</strong> with the <strong>10.4.254.254</strong> exists,</li>
<li>below <strong>OSPF routes</strong> are learned from this neighbor:<ul>
<li>prefix: <strong>10.4.0.0/24</strong></li>
<li>prefix: <strong>10.4.254.0/24</strong></li>
</ul>
</li>
<li>these OSPF routes are installed in the routing table.</li>
</ul>
<h2 id="step-3-verify-ospf-routes-redistribution">Step 3: Verify OSPF routes redistribution</h2>
<p>In the previous step, we configured the OSPF peering between BR2-vEdge and a neigbouring router on the LAN of this Branch2.  </p>
<p>Now lets confirm that OSPF routes (learned on BR2) are redistributed via OMP towards BR1.</p>
<ul>
<li>
<p>Using <strong>Mputty</strong> client on remote desktop, initiate a <strong>SSH</strong> session to <strong>BR1-vEdge</strong> (with IP address of <strong>198.18.134.105</strong>).  </p>
</li>
<li>
<p>Execute below commands on <strong>BR1-vEdge</strong> to verify that OSPF routes are learned from BR2:</p>
</li>
</ul>
<pre><code>show ip routes vpn 10
show omp routes
</code></pre>
<p>Below screenshot shows the output of of above commands on BR1-vEdge:</p>
<p><img alt="OSPF on BR1" src="../pics/t6-br1-show-route-omp.png" /></p>
<p>From the output of above commands, verify that OSPF routes of <strong>10.4.0.0</strong> has been <strong>redistributed via OMP</strong> by BR2-vEdge</p>
<ul>
<li>On <strong>BR1-vEdge</strong>, we can get more details (attributes learned via OMP) about the routes by using below command:</li>
</ul>
<pre><code>show omp routes vpn 10 10.4.0.0/24 detail
</code></pre>
<p>Below screenshot shows the output of of above commands on BR1-vEdge:</p>
<p><img alt="OSPF on BR1" src="../pics/t6-br1-show-omp-det.png" /></p>
<p>From the output of above command you can verify the attributes for <code>10.4.0.0/24</code> route such as:</p>
<ul>
<li><code>origin-proto</code> is <code>OSPF-intra-area</code> (so route is originated by OSPF)</li>
<li>
<p><code>tloc</code> entries show: </p>
<ul>
<li><code>system IP</code> of <code>10.4.0.1</code>, </li>
<li><code>color</code> of <code>mpls</code> &amp; <code>private1</code>.  This means that the route is learned over both WAN links (identified by color).</li>
</ul>
</li>
<li>
<p>In contrast you may run below command to see the <code>origin-proto</code> for route <code>10.4.254.0</code>:</p>
</li>
</ul>
<pre><code>show omp routes vpn 10 10.4.254.0/24 detail
</code></pre>
<p>Does the above output <code>10.4.254.0</code> makes sense?
 It basically shows that the route was directly connected on BR2! </p>
<hr />
<p>You have successfully finished this task of configuring OSPF on Service side of a branch</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.01de222e.min.js"></script>
      
    
  </body>
</html>